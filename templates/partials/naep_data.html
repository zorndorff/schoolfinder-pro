{{define "naep_data.html"}} {{if .NAEPData}}
<div class="naep-content">
  <p class="naep-info">
    <strong>Assessment Data:</strong> Nation's Report Card (NAEP) - National
    standardized test measuring student achievement<br />
    {{if .NAEPData.UseDistrict}}
    <strong>District:</strong> {{.NAEPData.District}} (more specific than state
    average) {{else}} <strong>State:</strong> {{.NAEPData.State}} {{end}}<br />
    <strong>Data cached:</strong> {{.NAEPData.ExtractedAt.Format "2006-01-02"}}
    (90-day cache)
  </p>

  <!-- Achievement Level Legend -->
  <div class="naep-legend">
    <strong>Achievement Levels:</strong>
    <span class="legend-item">
      <span class="legend-color below-basic"></span> Below Basic
    </span>
    <span class="legend-item">
      <span class="legend-color basic"></span> Basic
    </span>
    <span class="legend-item">
      <span class="legend-color proficient"></span> Proficient
    </span>
    <span class="legend-item">
      <span class="legend-color advanced"></span> Advanced
    </span>
  </div>

  <!-- Grade 4 Section -->
  {{if .NAEPData.Grade4Scores}}
  {{template "grade_section" .NAEPData.Grade4Scores}}
  {{end}}

  <!-- Grade 8 Section -->
  {{if .NAEPData.Grade8Scores}}
  {{template "grade_section" .NAEPData.Grade8Scores}}
  {{end}}

  <!-- Parent Guidance Note -->
  <div class="naep-guidance">
    <h4>ðŸ’¡ What this means for parents:</h4>
    <ul>
      <li>
        <strong>Proficient/Advanced:</strong> Students demonstrate solid
        academic performance at grade level
      </li>
      <li>
        <strong>Basic:</strong> Students show partial mastery of grade-level
        skills
      </li>
      <li>
        <strong>Below Basic:</strong> Students need additional support to reach
        grade-level expectations
      </li>
      <li>
        <strong>Important:</strong> These are {{if
        .NAEPData.UseDistrict}}district{{else}}state{{end}} averages -
        individual school results may vary
      </li>
    </ul>
  </div>
</div>
{{end}} {{end}}

{{define "grade_section"}}
{{if .}}
{{$grade := (index . 0).Grade}}
<details class="naep-grade-section" open>
  <summary class="grade-summary">
    <h3>Grade {{$grade}} Assessment Results</h3>
  </summary>
  <div class="grade-content">
    {{range .}}
    <div class="naep-subject-card">
      <div class="subject-header">
        <h4>
          {{if eq .Subject "mathematics"}}Mathematics
          {{else if eq .Subject "reading"}}Reading
          {{else if eq .Subject "science"}}Science
          {{else}}{{.Subject}}{{end}}
        </h4>
        {{if gt .MeanScore 0.0}}
        <span class="score-badge">{{printf "%.0f" .MeanScore}} pts</span>
        {{end}}
      </div>

      <div class="subject-stats">
        <div class="stat-item">
          <span class="stat-label">Proficient or Above:</span>
          <span class="stat-value proficient-pct">{{printf "%.0f" .AtProficient}}%</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Year:</span>
          <span class="stat-value">{{.Year}}</span>
        </div>
      </div>

      <!-- Achievement Distribution Bar -->
      {{if gt .AtProficient 0.0}}
      <div class="achievement-bar-container">
        <div class="achievement-bar">
          {{if gt .BelowBasicPct 0.0}}
          <div class="bar-segment below-basic" style="width: {{printf "%.1f" .BelowBasicPct}}%">
            <span class="bar-label">{{printf "%.0f" .BelowBasicPct}}%</span>
          </div>
          {{end}}
          {{if gt .BasicPct 0.0}}
          <div class="bar-segment basic" style="width: {{printf "%.1f" .BasicPct}}%">
            <span class="bar-label">{{printf "%.0f" .BasicPct}}%</span>
          </div>
          {{end}}
          {{if gt .ProficientPct 0.0}}
          <div class="bar-segment proficient" style="width: {{printf "%.1f" .ProficientPct}}%">
            <span class="bar-label">{{printf "%.0f" .ProficientPct}}%</span>
          </div>
          {{end}}
          {{if gt .AdvancedPct 0.0}}
          <div class="bar-segment advanced" style="width: {{printf "%.1f" .AdvancedPct}}%">
            <span class="bar-label">{{printf "%.0f" .AdvancedPct}}%</span>
          </div>
          {{end}}
        </div>
        <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem; font-style: italic;">
          * Below Basic and Basic percentages are estimated based on typical NAEP patterns.
          Only the combined Proficient+Advanced ({{printf "%.0f" .AtProficient}}%) is actual data from NAEP.
        </p>
      </div>
      {{end}}

      <!-- National Comparison -->
      {{if .NationalScore}}
      <div class="national-comparison">
        <div class="comparison-header">
          <strong>vs. National Average</strong>
          {{if eq .NationalCompare "Above"}}
          <span class="trend-indicator positive">â†‘ Above</span>
          {{else}}
          <span class="trend-indicator negative">â†“ Below</span>
          {{end}}
        </div>
        <div class="comparison-stats">
          <div class="comparison-row">
            <span>Local Proficient+:</span>
            <strong>{{printf "%.1f" .AtProficient}}%</strong>
          </div>
          <div class="comparison-row">
            <span>National Proficient+:</span>
            <strong>{{printf "%.1f" .NationalScore.AtProficient}}%</strong>
          </div>
        </div>
      </div>
      {{end}}
    </div>
    {{end}}
  </div>
</details>
{{end}}
{{end}}
