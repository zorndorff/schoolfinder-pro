<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - School Finder</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1><a href="/">School Finder</a></h1>
            <p class="subtitle">Search 102K+ schools from the Common Core of Data</p>
        </div>
    </header>

    <main class="container">
        <div class="detail-container">
            <div class="detail-header">
                <a href="/" class="back-link">‚Üê Back to Search</a>
                <h1>{{.School.Name}}</h1>
                <p class="school-id">NCES ID: {{.School.NCESSCH}}</p>
            </div>

            <div class="detail-grid">
                <!-- Basic Info Card -->
                <div class="card">
                    <h2>Basic Information</h2>
                    <dl class="info-list">
                        <dt>School Type</dt>
                        <dd>{{.School.SchoolTypeString}}</dd>

                        <dt>Level</dt>
                        <dd>{{.School.LevelString}}</dd>

                        <dt>Grade Range</dt>
                        <dd>{{.School.GradeRangeString}}</dd>

                        <dt>Charter School</dt>
                        <dd>{{.School.CharterString}}</dd>

                        <dt>School Year</dt>
                        <dd>{{.School.SchoolYear}}</dd>
                    </dl>
                </div>

                <!-- Location Card -->
                <div class="card">
                    <h2>Location</h2>
                    <dl class="info-list">
                        <dt>Address</dt>
                        <dd>{{.School.FullAddress}}<br>{{.School.City}}, {{.School.State}} {{.School.ZipString}}</dd>

                        <dt>State</dt>
                        <dd>{{.School.StateName}}</dd>

                        <dt>District</dt>
                        <dd>{{.School.District}}</dd>
                    </dl>
                </div>

                <!-- Contact Card -->
                <div class="card">
                    <h2>Contact</h2>
                    <dl class="info-list">
                        <dt>Phone</dt>
                        <dd>{{.School.PhoneString}}</dd>

                        <dt>Website</dt>
                        <dd>
                            {{if ne (.School.WebsiteString) "N/A"}}
                            <a href="{{.School.WebsiteString}}" target="_blank" rel="noopener noreferrer">{{.School.WebsiteString}}</a>
                            {{else}}
                            N/A
                            {{end}}
                        </dd>
                    </dl>
                </div>

                <!-- Statistics Card -->
                <div class="card">
                    <h2>Statistics</h2>
                    <dl class="info-list">
                        <dt>Enrollment</dt>
                        <dd>
                            {{.School.EnrollmentString}} students
                            {{if .School.Enrollment.Valid}}
                            <div class="chart-container">
                                <div class="bar-chart">
                                    <div class="bar" style="width: {{if gt .School.Enrollment.Int64 1000}}100{{else}}{{.School.Enrollment.Int64 | printf "%.0f" | printf "%s" | len | printf "%d" }}{{end}}%">
                                        {{.School.EnrollmentString}}
                                    </div>
                                </div>
                            </div>
                            {{end}}
                        </dd>

                        <dt>Teachers (FTE)</dt>
                        <dd>{{.School.TeachersString}}</dd>

                        <dt>Student-Teacher Ratio</dt>
                        <dd>{{.School.StudentTeacherRatio}}</dd>
                    </dl>
                </div>
            </div>

            <!-- NAEP Assessment Data Section -->
            <div class="card naep-section">
                <div class="naep-header">
                    <h2>üìä Nation's Report Card (NAEP) Data</h2>
                    {{if not .NAEPData}}
                    <button
                        hx-post="/schools/{{.School.NCESSCH}}/naep"
                        hx-target="#naep-data"
                        hx-swap="innerHTML"
                        hx-indicator="#naep-loading"
                        class="btn btn-primary"
                    >
                        Load Assessment Data
                    </button>
                    {{end}}
                </div>

                <div id="naep-loading" class="htmx-indicator">
                    <div class="spinner"></div>
                    <p>Fetching NAEP assessment data...</p>
                </div>

                <div id="naep-data">
                    {{if .NAEPData}}
                        {{template "naep_data.html" .}}
                    {{else}}
                        <p class="help-text">
                            Click "Load Assessment Data" to view standardized test results from the National Assessment
                            of Educational Progress (NAEP), also known as "The Nation's Report Card."
                            This data shows how students in this school's {{if .School.District}}district{{else}}state{{end}}
                            perform compared to national averages in mathematics, reading, and science.
                        </p>
                    {{end}}
                </div>
            </div>

            <!-- AI Data Section -->
            <div class="card ai-section">
                <div class="ai-header">
                    <h2>Enhanced School Data (AI Extracted)</h2>
                    {{if not .EnhancedData}}
                    <button
                        hx-post="/schools/{{.School.NCESSCH}}/ai"
                        hx-target="#ai-data"
                        hx-swap="innerHTML"
                        hx-indicator="#ai-loading"
                        class="btn btn-primary"
                    >
                        Extract Website Data
                    </button>
                    {{end}}
                </div>

                <div id="ai-loading" class="htmx-indicator">
                    <div class="spinner"></div>
                    <p>Extracting data from school website...</p>
                </div>

                <div id="ai-data">
                    {{if .EnhancedData}}
                        {{template "ai_data.html" .}}
                    {{else}}
                        <p class="help-text">
                            Click "Extract Website Data" to use AI to extract staff directory, programs, sports teams,
                            facilities, and other information from the school's website.
                        </p>
                    {{end}}
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>Data from NCES Common Core of Data (CCD) 2023-24 | <a href="https://github.com/yourusername/schoolfinder-pro">GitHub</a></p>
        </div>
    </footer>
    <script src="/static/charts.js"></script>
</body>
</html>
