{{define "naep_data.html"}}
{{if .NAEPData}}
<div class="naep-content">
    <p class="naep-info">
        <strong>Assessment Data:</strong> Nation's Report Card (NAEP) - National standardized test measuring student achievement
        <br>
        {{if .NAEPData.DistrictScores}}
        <strong>District:</strong> {{.NAEPData.District}} (more specific than state average)
        {{else}}
        <strong>State:</strong> {{.NAEPData.State}}
        {{end}}
        <br>
        <strong>Data cached:</strong> {{.NAEPData.ExtractedAt.Format "2006-01-02"}} (90-day cache)
    </p>

    <!-- Achievement Level Legend -->
    <div class="naep-legend">
        <strong>Achievement Levels:</strong>
        <span class="legend-item">
            <span class="legend-color below-basic"></span> Below Basic
        </span>
        <span class="legend-item">
            <span class="legend-color basic"></span> Basic
        </span>
        <span class="legend-item">
            <span class="legend-color proficient"></span> Proficient
        </span>
        <span class="legend-item">
            <span class="legend-color advanced"></span> Advanced
        </span>
    </div>

    {{$scores := .NAEPData.StateScores}}
    {{if .NAEPData.DistrictScores}}
        {{$scores = .NAEPData.DistrictScores}}
    {{end}}

    <!-- Iterate through all scores and display them -->
    {{range $scores}}
        <div class="naep-subject-card">
            <div class="subject-header">
                <h4>
                    Grade {{.Grade}} -
                    {{if eq .Subject "mathematics"}}Mathematics
                    {{else if eq .Subject "reading"}}Reading
                    {{else if eq .Subject "science"}}Science
                    {{else}}{{.Subject}}{{end}}
                </h4>
                {{if gt .MeanScore 0.0}}
                <span class="score-badge">{{printf "%.0f" .MeanScore}} pts</span>
                {{end}}
            </div>

            <div class="subject-stats">
                <div class="stat-item">
                    <span class="stat-label">Proficient or Above:</span>
                    <span class="stat-value proficient-pct">{{printf "%.0f" .AtProficient}}%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Year:</span>
                    <span class="stat-value">{{.Year}}</span>
                </div>
            </div>

            <!-- Achievement Distribution Bar -->
            {{if gt .AtProficient 0.0}}
            <div class="achievement-bar-container">
                <div class="achievement-bar">
                    <!-- Simplified: assume Below Basic ~30%, Basic ~35%, rest is Prof+ -->
                    <div class="bar-segment below-basic" style="width: 30%">
                        <span class="bar-label">30%</span>
                    </div>
                    <div class="bar-segment basic" style="width: 35%">
                        <span class="bar-label">35%</span>
                    </div>
                    <div class="bar-segment proficient-advanced" style="width: {{.AtProficient}}%">
                        <span class="bar-label">{{printf "%.0f" .AtProficient}}%</span>
                    </div>
                </div>
            </div>
            {{end}}

            <!-- Find and display national comparison -->
            {{if $.NAEPData.NationalScores}}
                {{$currentSubject := .Subject}}
                {{$currentGrade := .Grade}}
                {{$currentProf := .AtProficient}}
                {{range $.NAEPData.NationalScores}}
                    {{if and (eq .Subject $currentSubject) (eq .Grade $currentGrade)}}
                        <div class="national-comparison">
                            <div class="comparison-header">
                                <strong>vs. National Average</strong>
                                {{if ge $currentProf .AtProficient}}
                                <span class="trend-indicator positive">â†‘ Above</span>
                                {{else}}
                                <span class="trend-indicator negative">â†“ Below</span>
                                {{end}}
                            </div>
                            <div class="comparison-stats">
                                <div class="comparison-row">
                                    <span>Local Proficient+:</span>
                                    <strong>{{printf "%.1f" $currentProf}}%</strong>
                                </div>
                                <div class="comparison-row">
                                    <span>National Proficient+:</span>
                                    <strong>{{printf "%.1f" .AtProficient}}%</strong>
                                </div>
                            </div>
                        </div>
                    {{end}}
                {{end}}
            {{end}}
        </div>
    {{end}}

    <!-- Parent Guidance Note -->
    <div class="naep-guidance">
        <h4>ðŸ’¡ What this means for parents:</h4>
        <ul>
            <li><strong>Proficient/Advanced:</strong> Students demonstrate solid academic performance at grade level</li>
            <li><strong>Basic:</strong> Students show partial mastery of grade-level skills</li>
            <li><strong>Below Basic:</strong> Students need additional support to reach grade-level expectations</li>
            <li><strong>Important:</strong> These are {{if .NAEPData.DistrictScores}}district{{else}}state{{end}} averages - individual school results may vary</li>
        </ul>
    </div>
</div>
{{end}}
{{end}}
